<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordina più prodotti</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f8f8f8;
        }
        .container {
            max-width: 400px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .product {
            background: rgba(0, 0, 0, 0.05);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            font-size: 1em;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Riepilogo Ordine</h2>
        <div id="orderList"></div>
        <p id="totalPrice">Totale: 0€</p>
        <button onclick="sendOrder()">Invia Conferma Ordine</button>
    </div>

    <script>
        let orders = [];

        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const prodotto = params.get('prodotto');
            const prezzo = params.get('prezzo');

            if (prodotto && prezzo) {
                orders.push({ prodotto, prezzo, quantità: 1 });
                saveOrders();
            }
        }

        function saveOrders() {
            localStorage.setItem("ordini", JSON.stringify(orders));
            updateOrderList();
        }

        function updateOrderList() {
            const orderListDiv = document.getElementById("orderList");
            const totalDiv = document.getElementById("totalPrice");
            orderListDiv.innerHTML = "";
            let total = 0;

            orders.forEach((order, index) => {
                total += parseFloat(order.prezzo) * order.quantità;
                orderListDiv.innerHTML += `
                    <div class="product">
                        <p>${order.prodotto} - ${order.prezzo}€</p>
                        <label>Quantità: </label>
                        <input type="number" value="${order.quantità}" min="1" onchange="updateQuantity(${index}, this.value)">
                    </div>
                `;
            });

            totalDiv.innerHTML = `Totale: ${total.toFixed(2)}€`;
        }

        function updateQuantity(index, value) {
            orders[index].quantità = parseInt(value);
            saveOrders();
        }

        function sendOrder() {
            let message = "Ciao! Confermo il mio ordine:\n";
            let total = 0;

            orders.forEach(order => {
                message += `- ${order.quantità} x ${order.prodotto} (${order.prezzo}€)\n`;
                total += order.quantità * parseFloat(order.prezzo);
            });

            message += `Totale: ${total.toFixed(2)}€`;
            const whatsappURL = `https://wa.me/393717771328?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, "_blank");
        }

        window.onload = function() {
            orders = JSON.parse(localStorage.getItem("ordini")) || [];
            getUrlParams();
            updateOrderList();
        };
    </script>
</body>
</html>
